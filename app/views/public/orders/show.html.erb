<h1>注文履歴詳細</h1>

<h4>
  <%= link_to shop_path(@order.shop.id) do %>
    <%= @order.shop.name %>
  <% end %>
  注文情報
</h4>
  <table>
    <tbody>
      <tr>
        <th>注文日</th>
        <td><%= @order.created_at.to_s(:ymd) %></td>
      </tr>
      <tr>
        <th>配送先</th>
        <td>
          〒<%= @order.postal_code %><br>
          <%= @order.address %><br>
          <%= @order.name %>
        </td>
      </tr>
      <tr>
        <th>支払方法</th>
        <td><%= @order.payment_method_i18n %></td>
      </tr>
      <tr>
      <% if Order.find_by(params[:status]) && (@order.status == "receipt_confirmation") %>
        <%= form_with model: @order, url: order_path(@order), method: :patch do |f| %>
          <th><%= f.label :status, "注文ステータス" %></th>
          <td><%= @order.status_i18n %></td>
          <%= f.hidden_field :status, :value => "transaction_completed" %>
          <td><%= f.submit "取引完了" %></td>
        <% end %>
      <% else %>
          <th>注文ステータス</th>
          <td><%= @order.status_i18n %></td>
      <% end %>
      </tr>
    </tbody>
  </table>

<h4>請求情報</h4>
  <table>
    <tbody>
      <tr>
        <th>商品合計</th>
        <td><%= @total.to_s(:delimited) %></td>
      </tr>
      <tr>
        <th>配送料</th>
        <td><%= @order.shipping_cost.to_s(:delimited) %></td>
      </tr>
      <tr>
        <th>ご請求額</th>
        <td><%= @order.total_payment.to_s(:delimited) %></td>
      </tr>
    </tbody>
  </table>

<h4>注文内容</h4>
  <table>
    <% @order_details.each do |order_detail| %>
    <thead>
      <tr>
        <th>商品</th>
        <th>単価(税込)</th>
        <th>個数</th>
        <th>小計</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>
          <%= image_tag order_detail.item.get_item_images.first.variant(resize: "150x150").processed %>
          <%= order_detail.item.name %>
        </td>
        <td><%= order_detail.price.to_s(:delimited) %></td>
        <td><%= order_detail.amount %></td>
        <td><%= order_detail.subtotal.to_s(:delimited) %></td>
      </tr>
    </tbody>
    <% end %>
  </table>
